# 开发流程与分阶段交付（原生全终端 + 插件生态）

本流程遵循“laojun+taishang 全栈原生开发 AI 启动包（超详细版）”要求，分阶段推进，兼顾原生端差异、插件生态与后端能力建设。[0]

## 分阶段路线图
- 阶段1｜准备期（基础骨架与契约）
  - 目标：后端骨架、React 管理后台基础、OpenAPI 草案、数据库前缀策略（`lao_`/`tai_`）。
  - 交付物：
    - 后端：`services/api` 初始化（Gin，模块 `github.com/codetaoist/taishanglaojun`），健康检查接口；DB 初始化脚本 `db/schema.sql`。
    - 接口：`openapi/openapi.yaml`（分域路由 `/api/laojun/...`、`/api/taishang/...`）。
    - 前端：`apps/admin-react` 项目初始化（Vite + Ant Design），登录页与仪表盘骨架。
    - 文档：完成 P1 文档（架构、接口规范、数据模型、前端规划、插件体系、测试策略、环境搭建）。
  - 验收：能跑通健康检查，管理后台能加载并展示基础信息；完成 CI 初版跑通。

- 阶段2｜核心功能期（老君基础域）
  - 目标：插件管理闭环（安装/启停/升级/卸载）、审计日志、系统配置。
  - 交付物：
    - 接口：`/api/laojun/plugins`、`/api/laojun/audits`、`/api/laojun/configs`；幂等与错误码规范。
    - 数据：`lao_plugins`、`lao_plugin_versions`、`lao_audit_logs`；唯一索引与外键完整。
    - 前端：插件列表、安装/启停/升级/卸载操作流；审计列表与筛选；配置管理页面。
    - CI/CD：插件构建/签名校验/部署流水线；回滚策略与发布门禁。
  - 验收：插件操作全流程打通且具备审计；阈值覆盖率达标（单元>70%，契约>60%，E2E>40%）。

- 阶段3｜功能扩展期（太上域）
  - 目标：AI 模型注册、向量集合管理、任务编排与监控。
  - 交付物：
    - 接口：`/api/taishang/models`、`/api/taishang/vectors`、`/api/taishang/tasks`；任务状态流转设计。
    - 数据：`tai_models`、`tai_vector_collections`、`tai_tasks`；索引与分表建议。
    - 前端：模型/向量/任务管理页面与图表；状态监控与重试。
    - 性能：接口限流与异步队列；向量库接入（Milvus/Faiss）。
  - 验收：模向管控闭环，任务编排稳定；高并发下接口稳定性达预期。

- 阶段4｜插件生态期（市场与工具）
  - 目标：插件市场、前端集成协议、本地 C/S 工具、签名与兼容性验证。
  - 交付物：
    - 市场：插件检索/分类/详情；发布审核与版本通道。
    - 前端集成：React 端远程组件注册协议；原生端轻量插件能力（非UI）；统一事件与日志接口。
    - 工具：本地打包与签名工具；校验与上传；流水线触发；诊断日志采集。
  - 验收：插件发布与集成体验顺畅；工具链自助化可用。

- 阶段5｜稳定交付期（可运维与安全）
  - 目标：环境与部署脚本完善、监控告警、安全合规与性能优化。
  - 交付物：
    - 部署：IaC/脚本，蓝绿/灰度发布；多环境差异化配置；备份与恢复。
    - 监控：指标/日志/追踪；告警策略；SLO/SLI 定义与看板。
    - 安全：权限模型与审计加固；密钥与凭证管理；插件来源与签名策略完善。
  - 验收：可运维性与安全性达标；性能基线满足上线要求。

## 跨终端开发节奏与差异
- iOS：App Store 审核周期；隐私声明与权限文案；Beta（TestFlight）通道。
- Android：多渠道/多ROM差异；签名与打包；后台服务合规。
- 机器人（Qt/QML）：设备/工业发布流程；远程维护与回滚；硬件接口变更风险管理。
- 手表/小程序：接口合规审查；域名与安全策略；低功耗与打断安全。

## 流程准入与门禁示例
- 代码准入：静态检查、格式化、单元测试覆盖阈值门禁、秘密扫描（API keys）。
- 变更准入：OpenAPI 契约变更需评审与版本标记；DB 迁移必须伴随回滚方案与审计。
- 发布准入：构建产物签名与来源校验；发布窗口与灰度比例；监控告警正常。

## 产出物与里程碑验收清单
- 完整文档体系（索引到所有文档）
- OpenAPI（域分路由、请求/响应示例、错误码）
- DB Schema（`lao_`/`tai_` 前缀与索引）与迁移脚本
- 前端（React 管理后台）骨架与关键页面
- 原生端模板与集成契约（移动/机器人/手表）
- 插件打包与签名工具、CI/CD流水线及回滚策略

# 分阶段开发流程（原生差异扩充）

## 阶段划分与核心交付
- 阶段 P1（契约与文档）：
  - 交付：`openapi/laojun.yaml`、`openapi/taishang.yaml`、接口规范、数据模型、原生适配、UI/UX、测试策略、运维手册。
  - 门禁：契约评审、错误码统一、文档完整度与一致性。
- 阶段 P2（骨架与集成）：
  - 交付：后端控制器骨架（统一响应包装与错误码映射）、插件SDK骨架、原生端模板工程、CI 契约测试接入。
  - 门禁：编译与单测通过、契约测试通过、基础安全扫描。
- 阶段 P3（功能与联调）：
  - 交付：核心功能实现（插件 install/start/stop/upgrade/uninstall；模型/向量/任务基础路径）、前后端联调与端侧适配。
  - 门禁：集成测试、性能与资源阈值、灰度发布开关。

## 原生差异与流程适配
- iOS：
  - 证书/签名/描述文件准备；隐私问答与数据收集说明；App Store 审核时间纳入迭代计划。
  - 使用 Xcode 组织工作流；TestFlight 灰度发布。
- Android：
  - 多渠道与签名方案；目标 SDK 定期升级；AndroidX 与 Material 规范跟随。
  - 使用 Gradle 构建；内部渠道灰度与崩溃监控接入。
- Harmony：
  - 分布式能力启用与权限声明；跨设备协同测试流程纳入。
- 桌面：
  - 代码签名与沙箱限制；自动更新渠道与回滚策略。

## 评审与版本变更
- 契约与接口：变更先评审与版本化，提供兼容策略与迁移指引。
- 插件：清单与签名必须校验；权限位与资源配额评审。
- 测试：场景覆盖与并发矩阵需维持，不可降级。

> 参考：[0] https://www.doubao.com/thread/w30e30a4dcadbb935