# AI 大模型辅助开发指引

规范使用大模型生成文档、代码、测试与运维产物的流程、提示词与门禁，确保与 OpenAPI 契约、风格约束和资源限制对齐。

## 总原则
- 契约优先：所有交互严格基于 `openapi/openapi.yaml`；文档是人类可读补充
- 风格一致：Go 遵循 Effective Go；Python 遵循 PEP 8；统一错误码与响应包装
- 安全与资源：插件声明权限与签名校验；显式资源配额与限流；密钥不入仓

## 一、文档生成任务
- 老君接口规范文档
  - 输入：`openapi.yaml` 中 `/api/laojun/*` 路由与Schema
  - 产出：接口清单、参数格式、响应示例、错误码映射与幂等说明
  - 门禁：契约差异审查（自动/人工）；审计与权限一致性检查
- 插件开发手册（Go/Docker/AI）
  - 输入：插件清单 Schema、权限映射、SDK接口约定
  - 产出：SDK接口示例、开发要点、打包流程、签名与发布门禁
  - 门禁：安全与资源约束明确；越权与未公开API禁止
- 部署运维手册
  - 输入：部署架构、环境与依赖、CI/CD流程
  - 产出：环境准备、一键部署/回滚脚本设计、监控与告警、备份恢复
  - 门禁：可回滚、可演练、可观测三要素覆盖
- 测试用例集
  - 输入：契约与关键流程；错误码与边界条件
  - 产出：Unit/Integration/E2E 用例；性能基准与覆盖率门槛
  - 门禁：覆盖阈值达标；报告聚合与失败重跑策略

## 二、代码生成任务（文档阶段规划）
- 核心模块代码
  - 阶段顺序：`laojun 用户/存储模块` → `taishang 大模型/对话模块`
  - 约束：DTO/路由/中间件骨架以 OpenAPI 自动生成为主，手写服务逻辑
- 插件 SDK 代码
  - Go：laojun 插件 SDK；接口：Init/Start/Stop/Handle；签名/权限校验工具
  - Python：taishang AI 插件 SDK；接口：register_tool/infer；缓存与显存调度抽象
- 接口客户端代码
  - taishang 调用 laojun（Go/Python 客户端）；laojun 调用 taishang（Go 客户端）
  - 统一异常映射与重试策略；幂等键支持
- 部署脚本
  - `Dockerfile`、`docker-compose.yml`、备份脚本、CI/CD（GitHub Actions）
  - 策略：金丝雀/回滚；秘密与依赖扫描；契约门禁

## 三、优化与排查任务（文档阶段规划）
- 微调数据
  - 来源：用户交互日志与审计；脱敏清洗与标注策略
  - 产物：微调数据集与脚本（训练/评估/上线）
  - 门禁：隐私合规与效果验收（精度/召回）
- 接口性能优化
  - 缓存：Redis Key设计与过期策略；热点与资源限流
  - SQL：索引优化与批处理；连接池与并发策略
- 兼容性排查
  - 跨系统/设备适配测试脚本；网络/电量/性能边界验证
- 推理速度优化
  - 模型量化（INT8/FP16）；显存调度与批推理；异步与流水线化

## 四、核心约束提示
- 契约：接口改动必须版本化与评审；前后端/端侧同步升级
- 风格：Go（Effective Go），Python（PEP 8）与统一错误码/响应体
- 插件：实现指定接口；不得依赖未公开API；权限与签名校验通过
- 资源：CPU/Mem/GPU 显式配额；限流/熔断/降级；避免单插件占满资源

## 五、提示词模板（示例）
- 生成接口控制器骨架
  - 约束：以 `openapi/*.yaml` 的路径与Schema为准；返回统一响应体；错误码映射
- 生成插件 SDK 方法
  - 约束：包含 Init/Start/Stop/Handle；读取 `manifest.json` 与签名校验；权限位映射
- 生成测试用例
  - 约束：Unit/Integration/E2E 分层；覆盖边界与错误码；输出报告与覆盖率阈值
- 生成部署脚本
  - 约束：支持回滚；健康探针；秘密与依赖扫描；金丝雀策略

## 六、落地流程（工作流）
- 需求 → 契约（OpenAPI）→ 文档 → 代码生成（受控）→ 测试 → 部署
- 每步均有门禁与审计：合约差异、覆盖率、秘密扫描、性能阈值、回滚验证

## 参考与索引
- 接口：`docs/interfaces/*`、`openapi/*.yaml`
- 插件：`docs/plugins/*`
- 测试：`docs/testing/*`
- 运维：`docs/ops/*`
- 架构与仓库结构：`docs/architecture/*`