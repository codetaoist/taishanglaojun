# 原生多端测试方案（iOS/Android/机器人/手表 + Web 管理后台）

结合原生开发差异，针对各终端与后端接口制定测试策略、工具与覆盖阈值，保障从插件到AI能力的稳定交付。[0]

## 总体策略与阈值
- 阈值建议：
  - 单元测试（后端/前端/原生）：>70%
  - 契约测试（OpenAPI 请求/响应/错误码）：>60%
  - 端到端（E2E）：>40%
  - 关键路径（插件安装→启停→升级→卸载→审计）：必须覆盖
- 测试分层：单元 → 组件/集成 → 契约 → E2E → 性能/稳定性 → 安全。
- 数据与环境：使用前缀表（`lao_`/`tai_`）的测试库；隔离测试账号与密钥；回滚脚本与审计记录。

## 后端（Go/Gin）
- 工具：`testing`、`httptest`、`go-vcr`（接口录制/回放）、`sqlmock`、`testcontainers`。
- 契约：对 `openapi.yaml` 解析生成测试用例；校验请求/响应/错误码与分页/过滤/排序。
- 性能：`vegeta`/`wrk` 进行接口压测；限流与异步队列场景。
- 安全：鉴权与权限用例、幂等性校验、签名与来源校验路径。

## Web 管理后台（React）
- 工具：Vitest/Jest、Testing Library、Playwright。
- 覆盖：页面与组件（仪表盘、插件管理、审计、配置）；远程组件加载协议（沙箱/权限白名单）。
- E2E：插件全流程；弱网场景；错误提示与回滚反馈。

## iOS（Swift/SwiftUI）
- 工具：XCTest、XCUITest、Combine 测试辅助。
- 覆盖：导航与状态、权限弹窗、离线队列幂等；后台刷新与通知。
- E2E：关键功能完成路径与中断恢复；弱网与重试策略；Crash-free 指标监控。

## Android（Kotlin/Compose）
- 工具：JUnit、Robolectric、Espresso、MockK。
- 覆盖：生命周期与状态保存、前台服务与通知、权限与电源管理差异。
- E2E：操作流程（任务触发、状态展示）、离线与幂等；多ROM兼容。

## 机器人（Qt/QML）
- 工具：Qt Test、gtest/gmock；硬件接口模拟（串口/总线/传感器）。
- 覆盖：UI低延迟与大按钮交互；实时数据刷新；断网提示与日志入口。
- E2E：设备发布流程中的远程维护与回滚用例；异常采样与自愈策略。

## 手表/小程序
- 工具：WatchKit 测试、小游戏/小程序平台测试；性能与功耗分析。
- 覆盖：卡片化流程、通知优先、短操作路径；避免复杂输入。

## 契约与数据一致性
- 以 `openapi.yaml` 为事实源生成请求/响应测试；错误码与分页/过滤/排序统一校验。
- 数据一致性：`lao_` 操作必须审计；`tai_` 任务流转幂等；向量集合维度与索引一致性校验。

## 报告与门禁
- 输出测试报告（coverage/junit），纳入 CI 门禁；关键路径失败触发告警。
- 失败分类与问题单：接口契约、状态机、权限、性能、安全；建立回归用例库。

> 参考：[0] https://www.doubao.com/thread/w1745a17f59b91183