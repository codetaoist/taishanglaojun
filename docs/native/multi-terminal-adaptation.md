# 原生多终端适配细节（扩充版）

聚焦原生差异：屏幕适配、硬件调用、离线支持与发布差异。[0]

## 屏幕与布局
- iOS（SwiftUI）与 Android（Compose）：响应式布局，拆分组件，适配横竖屏与折叠屏。
- 机器人（Qt/QML）：固定分辨率 + 缩放策略；高对比与低延迟交互。
- 手表：极简、卡片化；避免复杂输入。

## 硬件与系统能力
- iOS：通知、背景刷新；权限弹窗与降级策略。
- Android：前台服务与通知渠道；不同厂商电源管理差异。
- 机器人：串口/总线/传感器；实时性与线程安全。
- 手表：低功耗、打断安全；通知优先。

## 离线与弱网
- 统一离线提示与队列：操作入队 → 网络恢复后重放。
- 本地缓存与幂等：关键操作带去重键；冲突优先本地提示与回滚。

## 发布与审核差异
- iOS：App Store 审核；隐私与权限说明完整。
- Android：多渠道与差异化政策；签名与包管理一致。
- 机器人：设备/工业环境发布流程；回滚与远程维护。
- 小程序：审核与接口合规；域名与安全策略。

## 屏幕与布局适配
- 响应式断点：手机/平板/桌面分层布局与可用空间策略。
- 安全区域与刘海：iOS `safeAreaInsets`；Android 状态栏/导航栏沉浸式。
- 字体与可访问性：动态字体缩放（iOS Dynamic Type / Android FontScale），保证阅读与组件不溢出。

## 硬件能力与系统 API
- 摄像头/麦克风：权限请求与降级路径（无权限时禁用录制入口）。
- 传感器：加速度计/陀螺仪/定位；后台访问需明确策略与用户提示。
- 存储与文件：系统沙箱路径与读写权限；外部存储适配与备份策略。

## 离线支持与数据一致性
- 缓存层级：内存缓存 → KV/本地数据库 → 远端源；定义过期与刷新策略。
- 离线队列：关键写操作入队重试；失败退避与上限，配合错误码与提示。
- 一致性：弱一致（列表/历史）与强一致（支付/任务状态）分级，避免交互卡顿。

## IPC 与跨组件通信
- iOS：`XPC`/`URLScheme`/`App Groups` 共享数据与调用；
- Android：`Binder`/`Intent`/`ContentProvider`；前后台进程通信安全校验。
- 桌面：本地 `gRPC`/`Unix Domain Socket`；权限与路径隔离。

## 权限模型与合规
- 精细化权限：按资源/动作映射；避免“宽权限”。
- 合规提示：收集/使用目的透明；敏感权限必须告知与可撤回。
- 审计：关键操作写审计日志（本地 + 远端），配合 `traceId`。

## 构建与发布差异
- iOS：证书/描述文件/签名；App Store 审核流程与隐私问答。
- Android：签名与渠道包；应用兼容性与目标 SDK 升级策略。
- Harmony：分布式能力声明与权限；跨设备协同测试覆盖。
- 桌面：代码签名（Developer ID / SignTool）；沙箱与自动更新渠道。

## 性能与能耗
- 资源配额：CPU/Mem/GPU 显式限制与监控；前后台切换降级策略。
- 图片/音视频：懒加载、分辨率与码率选择；硬件编解码优先。
- 启动与交互：冷/热启动指标，关键路径优化与骨架屏。

> 参考：[0] https://www.doubao.com/thread/w30e30a4dcadbb935