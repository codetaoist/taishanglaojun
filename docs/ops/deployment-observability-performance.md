# 部署、可观测与性能规划

统一环境配置、部署流程、监控指标与性能目标，保障稳定与可回滚。

## 部署策略
- 环境：`dev` → `staging` → `prod`；配置文件与密钥分环境管理。
- 交付：容器镜像与版本标签；蓝绿/金丝雀发布；回滚脚本与快照。
- 变更门禁：契约/测试覆盖/安全扫描达标方可发布；审计记录。

## 可观测性
- 指标：QPS、错误率、延迟、耗时、队列深度、向量检索耗时。
- 日志：结构化日志、traceId；审计日志与安全事件专用流。
- 追踪：分布式追踪（OpenTelemetry）；关键路由与任务流入链路。
- 告警：阈值与异常检测；发布回滚与任务失败比率告警。

## 性能规划
- 目标：API P95 < 200ms；向量检索 P95 < 500ms；任务吞吐稳定。
- 压测：合成流量与真实数据；限流/熔断验证；资源上下界测试。
- 优化：SQL 索引与批处理；并发模型与连接池；缓存与降级策略。

## 应急预案
- 故障分级与处置流程；影子模式与灰度验证回退。
- 数据保护：只读模式、延迟写入与快照恢复；跨域回滚协同。